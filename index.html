<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="baofeng.song, blog" />










<meta name="description" content="学习,记录,思考">
<meta property="og:type" content="website">
<meta property="og:title" content="baofeng.song">
<meta property="og:url" content="http://bfsong.github.io/index.html">
<meta property="og:site_name" content="baofeng.song">
<meta property="og:description" content="学习,记录,思考">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="baofeng.song">
<meta name="twitter:description" content="学习,记录,思考">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://bfsong.github.io/"/>





  <title>baofeng.song</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">baofeng.song</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">终生学习实践者</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2018/05/15/spring-boot-application-propetites/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/15/spring-boot-application-propetites/" itemprop="url">Spring Boot配置文件使用说明</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-15T17:56:04+08:00">
                2018-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-Boot配置文件使用说明"><a href="#Spring-Boot配置文件使用说明" class="headerlink" title="Spring Boot配置文件使用说明"></a>Spring Boot配置文件使用说明</h1><p>Spring Boot的配置文件可以使用传统的<code>properties</code>文件格式或<code>yaml</code>文件格式，建议选择<code>yaml</code>格式，多学点知识总是有好处的，更何况<code>yaml</code>格式的好处还挺多的（<a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html" target="_blank" rel="noopener">YAML 语言教程 - 阮一峰的网络日志</a>）。</p>
<p>本文档中所有示例都使用<code>yaml</code>格式的配置文件，配置文件名为<code>application.yaml</code>。<code>properties</code>配置文件与此区别不大。</p>
<h2 id="自定义属性与加载"><a href="#自定义属性与加载" class="headerlink" title="自定义属性与加载"></a>自定义属性与加载</h2><p>我们可以在配置文件中使用如下方式定义属性<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">blog.name:</span> <span class="string">bfsong的专栏</span></span><br></pre></td></tr></table></figure></p>
<p>然后在代码中通过<code>@Value(&quot;${属性名称}&quot;)</code>注解来注入对应的属性值<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Blog</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Value</span>(<span class="string">"$&#123;blog.name&#125;"</span>)</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="参数间的引用"><a href="#参数间的引用" class="headerlink" title="参数间的引用"></a>参数间的引用</h2><p>配置文件中的各个参数之间可以直接引用<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">blog.name</span> <span class="string">=</span> <span class="string">bfsong的专栏</span></span><br><span class="line"><span class="string">blog.title</span> <span class="string">=</span> <span class="string">Spring</span> <span class="string">Boot笔记</span> <span class="bullet">-</span> <span class="string">$&#123;blog.name&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用随机数"><a href="#使用随机数" class="headerlink" title="使用随机数"></a>使用随机数</h2><p>有些参数我们可能会希望它不是一个固定的值，这时可以使用<code>random</code>来生成随机的int、long或string值。<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 随机字符串</span></span><br><span class="line"><span class="string">blog.value:</span> <span class="string">$&#123;random.value&#125;</span></span><br><span class="line"><span class="comment"># 随机int</span></span><br><span class="line"><span class="string">blog.number:</span> <span class="string">$&#123;random.int&#125;</span></span><br><span class="line"><span class="comment"># 随机long</span></span><br><span class="line"><span class="string">blog.bignumber:</span> <span class="string">$&#123;random.long&#125;</span></span><br><span class="line"><span class="comment"># 10以内的随机数</span></span><br><span class="line"><span class="string">blog.test1:</span> <span class="string">$&#123;random.int(10)&#125;</span></span><br><span class="line"><span class="comment"># 10-20的随机数</span></span><br><span class="line"><span class="string">blog.test2:</span> <span class="string">$&#123;random.int[10,20]&#125;</span></span><br><span class="line"><span class="comment"># uuid</span></span><br><span class="line"><span class="string">blog.uuid:</span> <span class="string">$&#123;random.uuid&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="通过命令行设置属性值"><a href="#通过命令行设置属性值" class="headerlink" title="通过命令行设置属性值"></a>通过命令行设置属性值</h2><p>Spring Boot应用可以通过<code>java -jar xxx.jar --propertyname=value</code>这样的形式在启动时为属性分配不同的值。这给予了我们在启动应用时修改配置属性值的能力。</p>
<p>另外，Spring Boot也可以通过以下语句来屏蔽在启动应用时修改属性值：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SpringApplication.setAddCommandLineProperties(<span class="keyword">false</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="配置文件路径"><a href="#配置文件路径" class="headerlink" title="配置文件路径"></a>配置文件路径</h2><p>Spring应用从以下路径中加载配置文件，按以下优先级顺序（由高到低），高级别的会覆盖低级别的配置项。</p>
<ol>
<li>当前目录下的<code>/config</code>目录</li>
<li>当前目录</li>
<li>classpath下的<code>/config</code>目录</li>
<li>classpath根目录</li>
</ol>
<h2 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h2><p>通常应用都会被安装到几个不同的环境（比如开发、测试、生产等），每个环境都会有一些参数是不一样的。</p>
<p>Spring Boot对此也提供了支持，配置文件的名称只要满足<code>application-{profile}.yaml</code>格式即可，其中<code>{profile}</code>对应环境的标识：</p>
<ul>
<li><code>application-dev.yaml</code>: 开发环境</li>
<li><code>application-test.yaml</code>: 测试环境</li>
<li><code>application-prod.yaml</code>: 生产环境</li>
</ul>
<p>之后，需要在<code>application.yaml</code>中设置配置属性<code>spring.profiles.active</code>，其值对应<code>{profile}</code>的值。</p>
<p>如：<code>spring.profile.active: dev</code>，此时就会加载<code>application.yaml</code>和<code>application-dev.yaml</code>这两个配置文件的内容，两个文件中如有相同属性，会使用<code>application-dev.yaml</code>中的值。</p>
<p>参考：</p>
<ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html" target="_blank" rel="noopener">24. Externalized Configuration</a></li>
<li><a href="http://blog.didispace.com/springbootproperties/" target="_blank" rel="noopener">Spring Boot属性配置文件详解 | 程序猿DD</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2018/04/23/scrapy-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/23/scrapy-docker/" itemprop="url">scrapy docker教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-23T18:45:29+08:00">
                2018-04-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="scrapy-docker教程"><a href="#scrapy-docker教程" class="headerlink" title="scrapy docker教程"></a>scrapy docker教程</h1><p>说明：此文档主要聚焦在Docker的使用上，必须配和<a href="https://piaosanlang.gitbooks.io/spiders/" target="_blank" rel="noopener">爬虫教程 · 网络爬虫教程</a>一起使用。</p>
<p><strong>注意：</strong>一定要配合<a href="https://piaosanlang.gitbooks.io/spiders/04day/section4.3.html" target="_blank" rel="noopener">入门教程 · 网络爬虫教程</a>这一节一起使用。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>先放干货，使用docker来运行scrapy其实只需要做到以下两点即可：</p>
<ol>
<li>在项目的当前目录中</li>
<li>在scrapy命令前加上<code>docker run --name scrapy --rm -v $(pwd):/runtime/app aciobanu/scrapy</code></li>
</ol>
<p>如果你已经会使用scrapy了，看到这里就可以了。</p>
<hr>
<h2 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h2><p>从Docker hub下载<a href="https://hub.docker.com/r/aciobanu/scrapy/" target="_blank" rel="noopener">aciobanu/scrapy - Docker Hub</a>镜像并创建教程项目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir ~/scrapy</span><br><span class="line">$ cd ~/scrapy</span><br><span class="line">$ docker run --rm -v $(pwd):/runtime/app aciobanu/scrapy startproject tutorial</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>以上命令中<br><code>-v</code>是把当前目录映射到容器中的<code>/runtime/app</code>目录<br><code>--rm</code>是在停止容器后自动删除容器</p>
</blockquote>
<p>执行以上命令后会生成<code>tutorial</code>目录，这些文件分别是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scrapy.cfg: 项目的配置文件；（用于发布到服务器）</span><br><span class="line">tutorial/: 该项目文件夹。之后将在此编写Python代码。</span><br><span class="line">tutorial/items.py: 项目中的item文件;（定义结构化数据字段field）.</span><br><span class="line">tutorial/pipelines.py: 项目中的pipelines文件;（用于存放执行后期数据处理的功能，定义如何存储结构化数据)</span><br><span class="line">tutorial/settings.py: 项目的设置文件；(如何修改User-Agent，设置爬取时间间隔，设置代理，配置中间件等等)</span><br><span class="line">tutorial/spiders/: 放置spider代码的目录;（编写爬取网站规则）</span><br></pre></td></tr></table></figure></p>
<h2 id="编写爬虫"><a href="#编写爬虫" class="headerlink" title="编写爬虫"></a>编写爬虫</h2><h3 id="编写第一个爬虫"><a href="#编写第一个爬虫" class="headerlink" title="编写第一个爬虫"></a>编写第一个爬虫</h3><p>接下来按<a href="https://piaosanlang.gitbooks.io/spiders/04day/section4.3.html" target="_blank" rel="noopener">入门教程 · 网络爬虫教程</a>编写第一个爬虫。（请先去看完教程再回来继续）</p>
<h3 id="爬取"><a href="#爬取" class="headerlink" title="爬取"></a>爬取</h3><p>然后运行以下命令执行爬虫<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -v $(pwd):/runtime/app aciobanu/scrapy scrapy crawl tencent</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>以上命令中最后的<code>scrapy crawl tencent</code>就是我们要执行的命令</p>
</blockquote>
<p>可以看到已经生成了<code>tengxun.txt</code></p>
<h3 id="提取Item"><a href="#提取Item" class="headerlink" title="提取Item"></a>提取Item</h3><p>接下来运行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it  --rm -v $(pwd):/runtime/app aciobanu/scrapy scrapy shell &quot;http://hr.tencent.com/position.php?&amp;start=0#a&quot;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>以上命令中的<code>-it</code>意思是启用交互式命令行</p>
</blockquote>
<h4 id="尝试Selector选择器"><a href="#尝试Selector选择器" class="headerlink" title="尝试Selector选择器"></a>尝试Selector选择器</h4><p>之后可以尝试以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">response.xpath(&apos;//title&apos;)</span><br><span class="line">response.xpath(&apos;//title&apos;).extract()</span><br><span class="line">print response.xpath(&apos;//title&apos;).extract()[0]</span><br><span class="line">response.xpath(&apos;//title/text()&apos;)</span><br><span class="line">response.xpath(&apos;//title/text()&apos;)[0].extract()</span><br><span class="line">print response.xpath(&apos;//title/text()&apos;)[0].extract()</span><br><span class="line">response.xpath(&apos;//title/text()&apos;).re(&apos;(\w+):&apos;)</span><br></pre></td></tr></table></figure>
<p>还可以尝试更多的提取参数，查看输出内容的变化。</p>
<p>最后输入<code>quit()</code>关闭容器。</p>
<h4 id="提取数据"><a href="#提取数据" class="headerlink" title="提取数据"></a>提取数据</h4><p>按爬虫教程中修改<code>tencent_spider.py</code>文件内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> tutorial.items <span class="keyword">import</span> RecruitItem</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecruitSpider</span><span class="params">(scrapy.spiders.Spider)</span>:</span></span><br><span class="line">  name = <span class="string">"tencent"</span></span><br><span class="line">  allowed_domains = [<span class="string">"hr.tencent.com"</span>]</span><br><span class="line">  start_urls = [</span><br><span class="line">    <span class="string">"https://hr.tencent.com/position.php?&amp;start=0#a"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> sel <span class="keyword">in</span> response.xpath(<span class="string">'//*[@class="even"]'</span>):</span><br><span class="line">      name = sel.xpath(<span class="string">'./td[1]/a/text()'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">      detailLink = sel.xpath(<span class="string">'./td[1]/a/@href'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">      catalog = sel.xpath(<span class="string">'./td[2]/text()'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">      recruitNumber = sel.xpath(<span class="string">'./td[3]/text()'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">      workLocation = sel.xpath(<span class="string">'./td[4]/text()'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">      publishTime = sel.xpath(<span class="string">'./td[5]/text()'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">      print(name, detailLink, catalog,recruitNumber,workLocation,publishTime)</span><br><span class="line">      item = RecruitItem()</span><br><span class="line">      item[<span class="string">'name'</span>]=name.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">      item[<span class="string">'detailLink'</span>]=detailLink.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">      item[<span class="string">'catalog'</span>]=catalog.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">      item[<span class="string">'recruitNumber'</span>]=recruitNumber.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">      item[<span class="string">'workLocation'</span>]=workLocation.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">      item[<span class="string">'publishTime'</span>]=publishTime.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">      <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意最后的<code>print</code>要加括号。我运行时不加括号会出错。</p>
</blockquote>
<p>执行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name scrapy --rm -v $(pwd):/runtime/app aciobanu/scrapy scrapy crawl tencent -o items.json</span><br></pre></td></tr></table></figure>
<p>查看生成的<code>items.json</code>文件的内容，可以看到爬取的结果。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2018/04/11/在VirtualBox中使用EFI模式安装GRUB引导程序关机后无法引导系统的问题解决/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/11/在VirtualBox中使用EFI模式安装GRUB引导程序关机后无法引导系统的问题解决/" itemprop="url">在VirtualBox中使用EFI模式安装GRUB引导程序关机后无法引导系统的问题解决</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-11T09:36:21+08:00">
                2018-04-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="在VirtualBox中使用EFI模式安装GRUB引导程序关机后无法引导系统的问题解决"><a href="#在VirtualBox中使用EFI模式安装GRUB引导程序关机后无法引导系统的问题解决" class="headerlink" title="在VirtualBox中使用EFI模式安装GRUB引导程序关机后无法引导系统的问题解决"></a>在VirtualBox中使用EFI模式安装GRUB引导程序关机后无法引导系统的问题解决</h1><p>在VirtualBox里面安装了ArchLinux，安装完成后重启一切正常，关闭虚拟机再启动就出问题了，无法找到引导程序，开始还以为是哪里安装错了，又重新安装了一次，问题依旧。于是怀疑是启用了<code>EFI</code>模式的原因，在<a href="https://wiki.archlinux.org/index.php/VirtualBox#Installation_steps_for_Arch_Linux_guests" target="_blank" rel="noopener">VirtualBox - ArchWiki</a>页面上找到了相关的说明（具体见“Installation in EFI mode”这一节）。</p>
<p>解决方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Boot using an emergency system.</span><br><span class="line"></span><br><span class="line">Mount the ESP (probably /dev/sda1 -- the FAT partition that holds the boot loader).</span><br><span class="line"></span><br><span class="line">Rename EFI/refind on the ESP to EFI/BOOT</span><br><span class="line"></span><br><span class="line">Rename EFI/BOOT/refind_x64.efi to EFI/BOOT/bootx64.efi</span><br></pre></td></tr></table></figure>
<p>以后每次更新引导程序后都需要重新执行以上操作。</p>
<p>参考链接：</p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/VirtualBox#Installation_steps_for_Arch_Linux_guests" target="_blank" rel="noopener">VirtualBox - ArchWiki</a></li>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=158003" target="_blank" rel="noopener">[SOLVED] UEFI Virtualbox installation boot problems / Newbie Corner / Arch Linux Forums</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface#bcfg" target="_blank" rel="noopener">Unified Extensible Firmware Interface - ArchWiki</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2018/04/10/ArchLinux安装（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/10/ArchLinux安装（二）/" itemprop="url">ArchLinux安装（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-10T18:38:25+08:00">
                2018-04-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ArchLinux安装（二）"><a href="#ArchLinux安装（二）" class="headerlink" title="ArchLinux安装（二）"></a>ArchLinux安装（二）</h1><p>在上一篇<a href="/2017/01/19/ArchLinux%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/">ArchLinux安装（一）</a>我们安装了基本的Archlinux系统，这一篇我们要进行一些基本配置并安装<code>X window</code>。</p>
<h2 id="系统管理"><a href="#系统管理" class="headerlink" title="系统管理"></a>系统管理</h2><p>详细的配置文档可以参考<a href="https://wiki.archlinux.org/index.php/General_recommendations_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank" rel="noopener">General recommendations (简体中文) - ArchWiki</a>，这里只介绍我常用的配置。</p>
<h3 id="添加用户和组"><a href="#添加用户和组" class="headerlink" title="添加用户和组"></a>添加用户和组</h3><p>现在系统中只有<code>root</code>用户，为了安全起见，日常操作应该使用普通用户登录。</p>
<p>添加新用户并为其设置密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># useradd -m -g wheel -s /bin/bash username</span><br><span class="line"># passwd username</span><br></pre></td></tr></table></figure>
<p>之后就可以使用新用户登录系统了。</p>
<p>更详细的用户和组管理文档，可以参考<a href="https://wiki.archlinux.org/index.php/Users_and_groups#User_management" target="_blank" rel="noopener">Users and groups - ArchWiki</a>。</p>
<h3 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># pacman -S sudo</span><br><span class="line"># vim /etc/sudoers</span><br></pre></td></tr></table></figure>
<p>找到<code>%wheel All=(All) NOPASSWD: ALL</code>这一行，删除最前面的<code>#</code>符号，表示允许<code>wheel</code>组的用户可以使用<code>sudo</code>来执行需要<code>root</code>权限的命令并且不用输入密码。</p>
<p>更详细的文档可以参考<a href="https://wiki.archlinux.org/index.php/Sudo" target="_blank" rel="noopener">Sudo - ArchWiki</a></p>
<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p>执行以下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># pacman -S openssh</span><br><span class="line"># systemctl enable sshd</span><br><span class="line"># systemctl start sshd</span><br></pre></td></tr></table></figure></p>
<p>之后就可以用<code>ssh</code>远程登录上去了。</p>
<h2 id="包管理"><a href="#包管理" class="headerlink" title="包管理"></a>包管理</h2><h3 id="pacman"><a href="#pacman" class="headerlink" title="pacman"></a>pacman</h3><p>Arch Linux使用<code>pacman</code>做为包管理工具，最好花点时间看看下面两个文档。</p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Pacman#Installing_packages" target="_blank" rel="noopener">pacman - ArchWiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Pacman/Tips_and_tricks#aria2" target="_blank" rel="noopener">pacman/Tips and tricks - ArchWiki</a></li>
</ul>
<p>命令<code>sudo pacman -Syu</code>可以用来更新系统。</p>
<p>命令<code>sudo pacman -S package1 package2 ...</code>可以用来安装软件包。</p>
<p>更多用法可以运行<code>pacman -h</code>命令查看。</p>
<h3 id="Repositories"><a href="#Repositories" class="headerlink" title="Repositories"></a>Repositories</h3><p>如果需要安装32位应用程序，那需要开启<a href="https://wiki.archlinux.org/index.php/Multilib" target="_blank" rel="noopener">Multilib - ArchWiki</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/pacman.conf</span><br></pre></td></tr></table></figure>
<p>删除以下两行前面的<code>#</code>符号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[multilib]</span><br><span class="line">Include = /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure>
<p>然后运行<code>sudo pacman -Sy</code>命令更新系统，之后就可以安装32位应用程序了。</p>
<h3 id="Mirrors"><a href="#Mirrors" class="headerlink" title="Mirrors"></a>Mirrors</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure>
<p>在最上面添加以下两行内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Server = http://mirrors.163.com/archlinux/$repo/os/$arch</span><br><span class="line">Server = http://mirrors.aliyun.com/archlinux/$repo/os/$arch</span><br></pre></td></tr></table></figure></p>
<p>如果在安装时就编辑过此文件，那么就不用再编辑了。</p>
<h3 id="Arch-User-Repository"><a href="#Arch-User-Repository" class="headerlink" title="Arch User Repository"></a>Arch User Repository</h3><p><a href="https://wiki.archlinux.org/index.php/Arch_User_Repository" target="_blank" rel="noopener">Arch User Repository - ArchWiki</a>里有大量的非官方软件源，如果要安装非官方仓库里的软件，就需要从<code>AUR</code>下载软件源代码并编译安装。但安装步骤有点繁琐，所以我们需要使用工具。我使用的<code>yaourt</code>。</p>
<h3 id="yaourt"><a href="#yaourt" class="headerlink" title="yaourt"></a>yaourt</h3><p>安装前需要先执行<code>sudo pacman -S base-devel git</code>命令安装依赖的软件包。</p>
<p>安装方法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git clone https://aur.archlinux.org/package-query.git</span><br><span class="line">cd package-query</span><br><span class="line">makepkg -si</span><br><span class="line">cd ..</span><br><span class="line">git clone https://aur.archlinux.org/yaourt.git</span><br><span class="line">cd yaourt</span><br><span class="line">makepkg -si</span><br><span class="line">cd ..</span><br><span class="line">rm -rf package-query</span><br><span class="line">rm -rf yaourt</span><br></pre></td></tr></table></figure>
<p>之后可以运行<code>yaourt package</code>来查找并安装软件包。</p>
<h3 id="Arch-Linux中文社区仓库"><a href="#Arch-Linux中文社区仓库" class="headerlink" title="Arch Linux中文社区仓库"></a>Arch Linux中文社区仓库</h3><p>由于某些不可抗的原因，我们还需要添加中文社区仓库。</p>
<p>在<code>/etc/pacman.conf</code> 文件末尾添加以下三行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[archlinuxcn]</span><br><span class="line">SigLevel = Optional TrustedOnly</span><br><span class="line">Server = http://repo.archlinuxcn.org/$arch</span><br></pre></td></tr></table></figure>
<p>之后安装 archlinuxcn-keyring 包以导入 GPG key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Sy</span><br><span class="line">sudo pacman -S archlinuxcn-keyring</span><br></pre></td></tr></table></figure>
<h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><h3 id="Display-Drivers"><a href="#Display-Drivers" class="headerlink" title="Display Drivers"></a>Display Drivers</h3><p>默认的显示驱动<code>vesa</code>可以在大多数显卡上正常工作，不过如果想要获得更好的性能，你可以安装显示对应的驱动。</p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/ATI" target="_blank" rel="noopener">ATI - ArchWiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Intel_graphics" target="_blank" rel="noopener">Intel graphics - ArchWiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/NVIDIA" target="_blank" rel="noopener">NVIDIA - ArchWiki</a></li>
</ul>
<h3 id="Display-Manager"><a href="#Display-Manager" class="headerlink" title="Display Manager"></a>Display Manager</h3><p><a href="https://wiki.archlinux.org/index.php/Display_manager" target="_blank" rel="noopener">Display manager - ArchWiki</a></p>
<h3 id="Desktop-Environment"><a href="#Desktop-Environment" class="headerlink" title="Desktop Environment"></a>Desktop Environment</h3><p><a href="https://wiki.archlinux.org/index.php/Desktop_environment" target="_blank" rel="noopener">Desktop environment - ArchWiki</a></p>
<p>Display Manager和Desktop Environment可根据需要自行选择，这方面的组合实在是太多了，这里只介绍以下三个：</p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/GNOME" target="_blank" rel="noopener">GNOME - ArchWiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Xfce" target="_blank" rel="noopener">Xfce - ArchWiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/LXDE" target="_blank" rel="noopener">LXDE - ArchWiki</a></li>
</ul>
<h4 id="GNOME"><a href="#GNOME" class="headerlink" title="GNOME"></a>GNOME</h4><p>GNOME是最易用的桌面环境，对系统资源占用略高，如果你的电脑配置不错并且linux系统的使用经验不多，这是最适合的桌面了。</p>
<p>安装步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman gnome gnome-extra</span><br></pre></td></tr></table></figure>
<p>在询问选择时全部接受默认值即可。</p>
<p>启用GUI<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable gdm</span><br><span class="line">sudo systemctl start gdm</span><br></pre></td></tr></table></figure></p>
<h4 id="xfce"><a href="#xfce" class="headerlink" title="xfce"></a>xfce</h4><p>xfce是一个轻量级的现代桌面系统，我安装的就是这个桌面环境。</p>
<p>安装步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S lxdm xfce4 xfce4-goodies</span><br></pre></td></tr></table></figure>
<p>在询问选择时全部接受默认值即可。</p>
<p>启用GUI<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable lxdm</span><br><span class="line">sudo systemctl start lxdm</span><br></pre></td></tr></table></figure></p>
<p>登录时需要注意，在左下角的“桌面”选项中选择“Xfce session”才能正常登录。</p>
<h4 id="LXDE"><a href="#LXDE" class="headerlink" title="LXDE"></a>LXDE</h4><p>LXDE非常像windows 98，对系统资源的占用非常低，可以配置非常低的电脑上运行。</p>
<p>安装步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S lxde</span><br></pre></td></tr></table></figure>
<p>在询问选择时全部接受默认值即可。</p>
<p>启用GUI<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable lxdm</span><br><span class="line">sudo systemctl start lxdm</span><br></pre></td></tr></table></figure></p>
<h2 id="中文化"><a href="#中文化" class="headerlink" title="中文化"></a>中文化</h2><p>中文化的更多内容请参考<a href="https://wiki.archlinux.org/index.php/Arch_Linux_Localization_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank" rel="noopener">Arch Linux Localization (简体中文) - ArchWiki</a>。</p>
<h3 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h3><p>安装字体<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S adobe-source-han-sans-otc-fonts adobe-source-han-serif-otc-fonts noto-fonts-cjk adobe-source-han-sans-cn-fonts adobe-source-han-sans-tw-fonts adobe-source-han-serif-cn-fonts adobe-source-han-serif-tw-fonts wqy-zenhei wqy-bitmapfont ttf-arphic-ukai ttf-arphic-uming opendesktop-fonts ttf-hannom</span><br></pre></td></tr></table></figure></p>
<p>安装的过程中可能会卡一会儿，耐心等待即可。</p>
<h3 id="输入法"><a href="#输入法" class="headerlink" title="输入法"></a>输入法</h3><p>Linux中常用的输入法有<code>Fcitx</code>和<code>IBus</code>，这里只介绍<code>Fcitx</code>。</p>
<h4 id="Fcitx输入法"><a href="#Fcitx输入法" class="headerlink" title="Fcitx输入法"></a>Fcitx输入法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S fcitx-im fcitx-configtools</span><br></pre></td></tr></table></figure>
<p>在询问选择时全部接受默认值即可。</p>
<p>运行<code>fcitx</code>命令启动输入法，在任务栏中就可以看到输入法的图标了。在图标上点击左键，选择“配置”，即可打开输入法配置界面。</p>
<p>编辑<code>～/.xprofile</code>文件，添加以下三行内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export GTK_IM_MODULE=fcitx</span><br><span class="line">export QT_IM_MODULE=fcitx</span><br><span class="line">export XMODIFIERS=@im=fcitx</span><br></pre></td></tr></table></figure></p>
<p>除了内置的输入法，fcitx还支持扩展，你可以安装以下输入法:</p>
<ul>
<li><code>fcitx-sunpinyin</code> 在输入速度和输入精度之间有较好的平衡。</li>
<li><code>fcitx-libpinyin</code> 算法比 sunpinyin 先进。</li>
<li><code>fcitx-rime</code>, 即著名中文输入法 Rime IME的 Fcitx 版本。但它不支持 Fcitx 本身的特殊符号和快速输入功能，自定义设置请参见官方，</li>
<li><code>fcitx-googlepinyin</code>, Google 拼音输入法 for Android.</li>
<li><code>fcitx-sogoupinyin</code>(AUR), 搜狗输入法for linux—支持全拼、简拼、模糊音、云输入、皮肤、中英混输入。</li>
<li><code>fcitx-cloudpinyin</code> 可以提供云拼音输入的支持，支持 Fcitx 下的所有拼音输入法，Fcitx-rime 除外。</li>
<li><code>fcitx-chewing</code> 为 Fcitx 添加 chewing (繁体中文注音) 输入引擎支持。依赖 libchewing.</li>
<li><code>fcitx-table-extra</code> adds Cangjie, Zhengma, Boshiamy support.</li>
</ul>
<p>关于输入法的更多问题，请参考<a href="https://wiki.archlinux.org/index.php/Fcitx" target="_blank" rel="noopener">Fcitx - ArchWiki</a>。</p>
<p>至此，一个可用的Arch Linux桌面环境就安装好了，剩下的工作就是自行安装需要的软件和定制系统了。<a href="https://wiki.archlinux.org/" target="_blank" rel="noopener">ArchWiki</a>是这个星球上最好的linux文档了，有啥问题只管在上面搜索吧。</p>
<p>另外，以下链接也可以常去看看</p>
<ul>
<li><a href="https://bbs.archlinuxcn.org/index.php" target="_blank" rel="noopener">Arch Linux 中文论坛</a></li>
<li><a href="http://tieba.baidu.com/f?ie=utf-8&amp;kw=archlinux&amp;fr=search&amp;red_tag=v2415010384" target="_blank" rel="noopener">archlinux吧-百度贴吧</a></li>
<li><a href="https://www.zhihu.com/topic/19581195/hot" target="_blank" rel="noopener">Arch Linux - 知乎</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2018/03/28/Spring-Boot发送邮件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/28/Spring-Boot发送邮件/" itemprop="url">Spring Boot发送邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-28T16:04:55+08:00">
                2018-03-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-Boot-邮件发送"><a href="#Spring-Boot-邮件发送" class="headerlink" title="Spring Boot 邮件发送"></a>Spring Boot 邮件发送</h1><h2 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h2><p>build.gradle</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 添加邮件依赖</span><br><span class="line">compile(&apos;org.springframework.boot:spring-boot-starter-mail&apos;)</span><br><span class="line">// 用于处理邮件模版</span><br><span class="line">compile(&quot;org.springframework.boot:spring-boot-starter-thymeleaf&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="邮件服务器配置"><a href="#邮件服务器配置" class="headerlink" title="邮件服务器配置"></a>邮件服务器配置</h2><p>以下是邮件相关配置项说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Email (MailProperties)</span><br><span class="line">spring.mail.default-encoding=UTF-8 # Default MimeMessage encoding.</span><br><span class="line">spring.mail.host= # SMTP server host. For instance, `smtp.example.com`.</span><br><span class="line">spring.mail.jndi-name= # Session JNDI name. When set, takes precedence over other mail settings.</span><br><span class="line">spring.mail.password= # Login password of the SMTP server.</span><br><span class="line">spring.mail.port= # SMTP server port.</span><br><span class="line">spring.mail.properties.*= # Additional JavaMail session properties.</span><br><span class="line">spring.mail.protocol=smtp # Protocol used by the SMTP server.</span><br><span class="line">spring.mail.test-connection=false # Whether to test that the mail server is available on startup.</span><br><span class="line">spring.mail.username= # Login user of the SMTP server.</span><br></pre></td></tr></table></figure></p>
<p>以下是实际配置（注意：当服务器使用SSL加密时，最后一行是必须的）<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  mail:</span></span><br><span class="line"><span class="attr">    host:</span> <span class="string">smtp.exmail.qq.com</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">465</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">smtp</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">&lt;username&gt;</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">&lt;password&gt;</span></span><br><span class="line"><span class="attr">    properties:</span></span><br><span class="line"><span class="attr">      mail:</span></span><br><span class="line"><span class="attr">        smtp:</span></span><br><span class="line"><span class="attr">          auth:</span> <span class="literal">true</span></span><br><span class="line">          <span class="string">socketFactory.class:</span> <span class="string">javax.net.ssl.SSLSocketFactory</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Thymeleaf配置"><a href="#Thymeleaf配置" class="headerlink" title="Thymeleaf配置"></a>Thymeleaf配置</h2><p>以下是Thymeleaf的配置项说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring.thymeleaf.cache – enable/disable template caching.</span><br><span class="line">spring.thymeleaf.check-template – check that the template exists before rendering it.</span><br><span class="line">spring.thymeleaf.check-template-location – check that the templates location exists.</span><br><span class="line">spring.thymeleaf.content-type – specifies content-type value.</span><br><span class="line">spring.thymeleaf.enabled – enable mvc thymeleaf view resolution.</span><br><span class="line">spring.thymeleaf.encoding – specifies template encoding.</span><br><span class="line">spring.thymeleaf.excluded-view-names – comma-separated list of view names that should be excluded from resolution.</span><br><span class="line">spring.thymeleaf.mode – template mode to be applied to templates. See also StandardTemplateModeHandlers.</span><br><span class="line">spring.thymeleaf.prefix – specifies the prefix that gets prepended to view names when building a URL.</span><br><span class="line">spring.thymeleaf.suffix – specifies the suffix that gets appended to view names when building a URL.</span><br><span class="line">spring.thymeleaf.template-resolver-order – specifies the order of the template resolver in the chain.</span><br><span class="line">spring.thymeleaf.view-names – comma-separated list of view names that can be resolved.</span><br></pre></td></tr></table></figure></p>
<p>也可以使用java代码进行配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringTemplateEngine <span class="title">springTemplateEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SpringTemplateEngine templateEngine = <span class="keyword">new</span> SpringTemplateEngine();</span><br><span class="line">        templateEngine.addTemplateResolver(htmlTemplateResolver());</span><br><span class="line">        <span class="keyword">return</span> templateEngine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringResourceTemplateResolver <span class="title">htmlTemplateResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SpringResourceTemplateResolver emailTemplateResolver = <span class="keyword">new</span> SpringResourceTemplateResolver();</span><br><span class="line">        emailTemplateResolver.setPrefix(<span class="string">"classpath:/templates/"</span>);</span><br><span class="line">        emailTemplateResolver.setSuffix(<span class="string">".html"</span>);</span><br><span class="line">        emailTemplateResolver.setTemplateMode(StandardTemplateModeHandlers.HTML5.getTemplateModeName());</span><br><span class="line">        emailTemplateResolver.setCharacterEncoding(StandardCharsets.UTF_8.name());</span><br><span class="line">        <span class="keyword">return</span> emailTemplateResolver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailHelper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;mail.from&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String from;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;mail.nickname&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SpringTemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送纯文本内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> MessagingException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendTextMail</span><span class="params">(String to, String title, String text)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">        MimeMessage mimeMessage = mailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">false</span>,<span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            helper.setFrom(<span class="keyword">new</span> InternetAddress(from, nickname, <span class="string">"UTF-8"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e)&#123;</span><br><span class="line">            helper.setFrom(from);</span><br><span class="line">        &#125;</span><br><span class="line">        helper.setTo(to);</span><br><span class="line">        helper.setSubject(title);</span><br><span class="line">        helper.setText(text);</span><br><span class="line">        mailSender.send(mimeMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送模版邮件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templateName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> files</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> MessagingException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendTemplateMail</span><span class="params">(String to, String title, String templateName, Map data, Map&lt;String, String&gt; files)</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">        MimeMessage mimeMessage = mailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">        Context context = <span class="keyword">new</span> Context();</span><br><span class="line">        context.setVariables(data);</span><br><span class="line">        String html = templateEngine.process(templateName, context);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            helper.setFrom(<span class="keyword">new</span> InternetAddress(from, nickname, <span class="string">"UTF-8"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e)&#123;</span><br><span class="line">            helper.setFrom(from);</span><br><span class="line">        &#125;</span><br><span class="line">        helper.setTo(to);</span><br><span class="line">        helper.setSubject(title);</span><br><span class="line">        helper.setText(html, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != files)&#123;</span><br><span class="line">            <span class="keyword">for</span>(String name: files.keySet())&#123;</span><br><span class="line">                ClassPathResource file = <span class="keyword">new</span> ClassPathResource(files.get(name));</span><br><span class="line">                helper.addInline(name, file);  <span class="comment">// 内联图片</span></span><br><span class="line">                <span class="comment">// helper.addAttachment(name, file); // 添加附件</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mailSender.send(mimeMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Thymeleaf-模版"><a href="#Thymeleaf-模版" class="headerlink" title="Thymeleaf 模版"></a>Thymeleaf 模版</h2><p>Thymeleaf模版的使用网上教程很多，这里放一个示例。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"webjars/bootstrap/3.3.7/css/bootstrap.min.css"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/css/main.css&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Getting Started: Serving Web Content<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-static-top"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">"#navbar"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span> <span class="attr">aria-controls</span>=<span class="string">"navbar"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/img/logo.png&#125;"</span> <span class="attr">alt</span>=<span class="string">"memorynotfound logo"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#about"</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#contact"</span>&gt;</span>Contact<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"starter-template"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Spring Boot Thymeleaf Configuration Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">th:text</span>=<span class="string">"$&#123;message&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- include javascript --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"webjars/jquery/3.2.1/jquery.min.js/"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"webjars/bootstrap/3.3.7/js/bootstrap.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果在邮件中使用内联图片，图片的<code>src</code>属性需要按如下代码设置<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"cid:facebook"</span> <span class="attr">height</span>=<span class="string">"28"</span> <span class="attr">alt</span>=<span class="string">"facebook"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其中<code>cid</code>的值是<code>MimeMessageHelper.addInline()</code>方法第一个参数的值。</p>
<p>参考：</p>
<ul>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-email.html" target="_blank" rel="noopener">Sending Email</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html" target="_blank" rel="noopener">Appendix A. Common application properties</a></li>
<li><a href="https://memorynotfound.com/spring-boot-thymeleaf-configuration-example/" target="_blank" rel="noopener">Spring Boot Thymeleaf Configuration Example - Memorynotfound</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2017/07/27/gulp入门教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/27/gulp入门教程/" itemprop="url">gulp入门教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-27T15:51:23+08:00">
                2017-07-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Gulp-入门教程"><a href="#Gulp-入门教程" class="headerlink" title="Gulp 入门教程"></a>Gulp 入门教程</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol>
<li><p>全局安装<code>gulp</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> npm install -g gulp</span><br></pre></td></tr></table></figure>
</li>
<li><p>作为项目的开发依赖安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npm install --save-dev gulp</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>在项目根目录下创建一个名为<code>gulpfile.js</code>的文件，内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将你的默认的任务代码放在这</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>在项目根目录下运行以下命令：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> gulp</span><br></pre></td></tr></table></figure></p>
<p>可以看到名为<code>default</code>的任务已经执行了。<br>想要单独执行特定的任务，输入<code>gulp &lt;taskname&gt;</code>。可以连续输入多个任务名称，以空格分开任务名称即可。</p>
<p>现在你已经可以开始使用<code>gulp</code>了。接下来一起学习下<code>gulp</code>的API。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p><code>gulp</code>核心的API只有四个函数，<code>gulp.src</code>、<code>gulp.dest</code>、<code>gulp.task</code>和<code>gulp.watch</code>。</p>
<h3 id="gulp-src"><a href="#gulp-src" class="headerlink" title="gulp.src"></a>gulp.src</h3><p>gulp.src(globs[, options])<br><strong>功能：</strong><br>输出符合参数<code>globs</code>所提供的单个（或数组）匹配模式的文件夹。返回一个<a href="https://github.com/gulpjs/vinyl-fs" target="_blank" rel="noopener">Vinyl files</a>的<a href="http://nodejs.org/api/stream.html" target="_blank" rel="noopener">stream</a>， 它可以被<a href="http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options" target="_blank" rel="noopener">pipe</a>到别的插件中去。</p>
<p><strong>参数说明：</strong> <em>（参数只做简单说明，详细的说明看<a href="http://www.gulpjs.com.cn/docs/api/" target="_blank" rel="noopener">这里</a>）</em></p>
<p>globs</p>
<p>类型：<code>String</code>或<code>Array</code>。</p>
<p>匹配目标文件（夹）路径的<a href="https://en.wikipedia.org/wiki/Glob_%28programming%29" target="_blank" rel="noopener"><code>glob</code></a>表达式。</p>
<p>options</p>
<p>类型：<code>Object</code>。</p>
<p><strong>示例：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">'client/js/**/*.js'</span>) <span class="comment">// 匹配 'client/js/somedir/somefile.js' 并且将 `base` 解析为 `client/js/`</span></span><br><span class="line">  .pipe(minify())</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'build'</span>));  <span class="comment">// 写入 'build/somedir/somefile.js'</span></span><br><span class="line"></span><br><span class="line">gulp.src(<span class="string">'client/js/**/*.js'</span>, &#123; <span class="attr">base</span>: <span class="string">'client'</span> &#125;)</span><br><span class="line">  .pipe(minify())</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'build'</span>));  <span class="comment">// 写入 'build/js/somedir/somefile.js'</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意参数<code>{base: &#39;client&#39;}</code>所产生的不同。</p>
</blockquote>
<h3 id="gulp-dest"><a href="#gulp-dest" class="headerlink" title="gulp.dest"></a>gulp.dest</h3><p>gulp.dest(path[, options])</p>
<p><strong>功能：</strong><br>能被<code>pipe</code>进来，并且将会写文件。并且重新输出所有数据，因此你可以将它<code>pipe</code>到多个文件夹。如果某文件夹不存在，将会自动创建它。</p>
<p>文件被写入的路径是以所给的相对路径根据所给的目标目录计算而来。类似的，相对路径也可以根据所给的 base 来计算。 请查看上述的<code>gulp.src</code>示例代码来了解更多信息。</p>
<p><strong>参数：</strong></p>
<p>path</p>
<p>类型：<code>String</code>或<code>Function</code>。</p>
<p>文件将被写入的路径（输出目录）。也可以传入一个函数，在函数中返回相应路径，这个函数也可以由 vinyl 文件实例 来提供。</p>
<p>options</p>
<p>类型：<code>Object</code>。</p>
<p><strong>示例：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">'./client/templates/*.jade'</span>)</span><br><span class="line">  .pipe(jade())</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'./build/templates'</span>))</span><br><span class="line">  .pipe(minify())</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'./build/minified_templates'</span>));</span><br></pre></td></tr></table></figure>
<h3 id="gulp-task"><a href="#gulp-task" class="headerlink" title="gulp.task"></a>gulp.task</h3><p>gulp.task(name[, deps] [, fn])</p>
<p><strong>功能：</strong></p>
<p>定义一个任务。</p>
<p><strong>参数：</strong></p>
<p>name</p>
<p>类型：<code>String</code>。</p>
<p>任务的名称。如果在要命令行中运行此任务，名称中不要包含空格。</p>
<p>deps</p>
<p>类型：<code>Array</code></p>
<p>一个包含任务列表的数组，这些任务会在你当前任务运行之前完成。</p>
<p>fn</p>
<p>类型：<code>Function</code>。</p>
<p>该函数定义任务所要执行的一些操作。</p>
<p>通常来说，它会是这种形式：<code>gulp.src().pipe(someplugin())</code>。</p>
<p><strong>示例：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个 callback，因此系统可以知道它什么时候完成</span></span><br><span class="line">gulp.task(<span class="string">'one'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 做一些事 -- 异步的或者其他的</span></span><br><span class="line">    cb(err); <span class="comment">// 如果 err 不是 null 或 undefined，则会停止执行，且注意，这样代表执行失败了</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个所依赖的 task 必须在这个 task 执行之前完成</span></span><br><span class="line">gulp.task(<span class="string">'two'</span>, [<span class="string">'one'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 'one' 完成后</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'one'</span>, <span class="string">'two'</span>]);</span><br></pre></td></tr></table></figure></p>
<h3 id="gulp-watch"><a href="#gulp-watch" class="headerlink" title="gulp.watch"></a>gulp.watch</h3><p>gulp.watch(glob[, opts], tasks) 或 gulp.watch(glob[, opts, cb])</p>
<p><strong>功能：</strong></p>
<p>监视文件，并且可以在文件发生改动时候做一些事情。它总会返回一个 EventEmitter 来发射（emit） change 事件。</p>
<p><strong>参数：</strong></p>
<p>glob</p>
<p>类型：<code>String</code>或<code>Array</code>。</p>
<p>匹配目标文件（夹）路径的<code>glob</code>表达式，用来指定具体监控哪些文件的变动。</p>
<p>opts</p>
<p>类型：<code>Object</code>。</p>
<p>tasks</p>
<p>类型：<code>Array</code>。</p>
<p>需要在文件变动后执行的一个或者多个通过 gulp.task() 创建的 task 的名字</p>
<p>cb</p>
<p>类型：<code>Function</code>。</p>
<p>每次变动需要执行的回调（callback）函数。</p>
<p><strong>示例：</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gulp.watch(<span class="string">'js/**/*.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'File '</span> + event.path + <span class="string">' was '</span> + event.type + <span class="string">', running tasks...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>callback 会被传入一个名为 <code>event</code> 的对象。这个对象描述了所监控到的变动：</p>
<p><code>event.type</code></p>
<p>类型： <code>String</code></p>
<p>发生的变动的类型：<code>added</code>, <code>changed</code> 或者 <code>deleted</code>。</p>
<p><code>event.path</code></p>
<p>类型： <code>String</code></p>
<p>触发了该事件的文件的路径。</p>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p>以下说明插件的基本用法。</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npm install --save-dev &lt;plugin-name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="添加引用"><a href="#添加引用" class="headerlink" title="添加引用"></a>添加引用</h3><p>在<code>gulpfile.js</code>中添加引用声明：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var &lt;name&gt; = require('&lt;plugin-name&gt;');</span><br></pre></td></tr></table></figure></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>请参考之前示例代码。</p>
<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev gulp-less</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> less = <span class="built_in">require</span>(<span class="string">'gulp-less'</span>);</span><br></pre></td></tr></table></figure>
<hr>
<p>了解了以上内容之后就可以使用<code>gulp</code>做事了。进阶的用法和技巧，可以看<a href="http://www.gulpjs.com.cn/docs/api/" target="_blank" rel="noopener">API文档</a>和<a href="http://www.gulpjs.com.cn/docs/recipes/" target="_blank" rel="noopener">gulp技巧集</a>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2017/05/02/Spring Boot使用MyBatis连接多数据源/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/02/Spring Boot使用MyBatis连接多数据源/" itemprop="url">Spring Boot使用MyBatis连接多数据源</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-02T14:54:17+08:00">
                2017-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-Boot使用MyBatis连接多数据源"><a href="#Spring-Boot使用MyBatis连接多数据源" class="headerlink" title="Spring Boot使用MyBatis连接多数据源"></a>Spring Boot使用MyBatis连接多数据源</h1><p>本文说明了如何在Spring Boot项目中使用MyBatis配置并连接两个不同的数据源的方法。<br>其核心思想是通过命名空间来把<code>Mapper</code>与数据源关联起来。</p>
<h2 id="定义数据源配置"><a href="#定义数据源配置" class="headerlink" title="定义数据源配置"></a>定义数据源配置</h2><h3 id="连接配置类"><a href="#连接配置类" class="headerlink" title="连接配置类"></a>连接配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义数据库连接一</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"com.xxx.mapper.db1"</span>&#125;,</span><br><span class="line">			sqlSessionFactoryRef = <span class="string">"db1SqlSessionFactory"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Db1DatabaseConfig</span> </span>&#123;</span><br><span class="line">	<span class="comment">//指定xml配置文件路径</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAPPER_XML_PATH = <span class="string">"classpath:mapper/db1/*.xml"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"db1DataSourceProperties"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">"datasource.db1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">db1DataSourceProperties</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"db1DataSource"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">"datasource.db1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">db1DataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> db1DataSourceProperties().initializeDataSourceBuilder().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"db1SqlSessionFactory"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">db1SqlSessionFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			    @Qualifier(<span class="string">"db1DataSource"</span>)</span> DataSource dataSource)</span></span><br><span class="line"><span class="function">			    <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> SqlSessionFactoryBean sessionFactory = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        sessionFactory.setDataSource(dataSource);</span><br><span class="line">        sessionFactory.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver()</span><br><span class="line">					        .getResources(MAPPER_XML_PATH));</span><br><span class="line">        <span class="keyword">return</span> sessionFactory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span>(name = <span class="string">"db1JdbcTemplate"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">db1Template</span><span class="params">(@Qualifier(<span class="string">"db1DataSource"</span>)</span> DataSource dataSource) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"db1TransactionManager"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">db1DataSourceTransactionManager</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @Qualifier(<span class="string">"db1DataSource"</span>)</span> DataSource dataSource) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码中<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"com.xxx.mapper.db1"</span>&#125;, sqlSessionFactoryRef = <span class="string">"db1SqlSessionFactory"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MAPPER_XML_PATH = <span class="string">"classpath:mapper/db1/*.xml"</span>;</span><br><span class="line"></span><br><span class="line">sessionFactory.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver()</span><br><span class="line">					        .getResources(MAPPER_XML_PATH));</span><br></pre></td></tr></table></figure></p>
<p>这三行就是建立数据源与<code>Mapper</code>之间关联的关键代码。<br><strong>注意<code>@Qualifier</code>注解的使用。</strong></p>
<p>给每个数据源创建一个配置类即可。只有一个数据源配置中可以使用<code>@Primary</code>注解，使其成为默认装配实例。</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"datasource.db1"</span>)</span><br></pre></td></tr></table></figure>
<p>连接配置类中这一行指定了配置项别名，在配置文件中就可以这样写：</p>
<p><code>application.yaml</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">  db1:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="string">'jdbc:mysql://localhost/db1?useSSL=false'</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">user1</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">password</span></span><br><span class="line"><span class="attr">  db2:</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="string">'jdbc:mysql://localhost/db2?useSSL=false'</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">user2</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><p><code>Mapper</code>类的命名空间决定了它使用哪一个数据源，参考<code>定义数据源配置</code>一节中的<code>basePackages</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxx.mapper.db1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>在<code>Service</code>类中的<code>transactionManager = &quot;db1TransactionManager&quot;</code>决定了它使用哪一个数据源的事务管理器。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxx.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xxx.mapper.db1.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.xxx.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span>(transactionManager = <span class="string">"db1TransactionManager"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="http://docs.spring.io/spring-boot/docs/1.5.2.BUILD-SNAPSHOT/reference/htmlsingle/#howto-two-datasources" target="_blank" rel="noopener">Spring Boot: howto-two-datasources</a></li>
<li><a href="http://www.infoq.com/cn/articles/Multiple-Databases-with-Spring-Boot" target="_blank" rel="noopener">在Spring中同时访问多种不同数据库</a></li>
<li><a href="http://emacoo.cn/backend/spring-boot-multi-db/" target="_blank" rel="noopener">如何在单个Boot应用中配置多数据库？</a></li>
<li><a href="http://guobinwu.leanote.com/post/springboot-mybatis-multidatasource" target="_blank" rel="noopener">springboot + mybatis + multi datasource</a></li>
<li><a href="http://stackoverflow.com/questions/18201075/mybatis-spring-multiple-databases-java-configuration" target="_blank" rel="noopener">Mybatis Spring multiple databases Java configuration
</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2017/03/14/Lombok使用手册/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/14/Lombok使用手册/" itemprop="url">Lombok使用手册</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-14T15:59:06+08:00">
                2017-03-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Lombok是一个能让你少写代码的Java库。本文简单介绍了Lombok的常用功能，更多功能可以去<a href="https://projectlombok.org/index.html" target="_blank" rel="noopener">Lombok官网</a>查看。</p>
<blockquote>
<p>声明：以下所有示例代码均来自lombok官方网站。</p>
</blockquote>
<h2 id="安装到IDE"><a href="#安装到IDE" class="headerlink" title="安装到IDE"></a>安装到IDE</h2><h3 id="Eclipse-amp-STS"><a href="#Eclipse-amp-STS" class="headerlink" title="Eclipse &amp; STS"></a>Eclipse &amp; STS</h3><p>双击<code>lombok.jar</code>或运行以下命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar lombok.jar</span><br></pre></td></tr></table></figure></p>
<p>会启动安装向导，如下图所示<br><img src="http://jnb.ociweb.com/jnb/jnbJan2010_files/jnbJan2010-LombokInstaller.png" alt="@lombok安装图"><br>点击“Install/Update”即可。</p>
<h3 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h3><p>在插件中心搜索<code>lombok</code>，然后在搜索结果中选择<code>Lombok Plugin</code>，再点击右侧的<code>Install</code>按钮安装即可。<br>安装完成后，在<code>Build,Execution,Deployment &gt; Compiler &gt; Annotation Processors</code>设置画面中选中<code>Enable annotation processing</code>。</p>
<h2 id="安装到项目"><a href="#安装到项目" class="headerlink" title="安装到项目"></a>安装到项目</h2><h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://mvnrepository.com/artifact/org.projectlombok/lombok</span></span><br><span class="line"><span class="keyword">compile</span> <span class="keyword">group</span>: <span class="string">'org.projectlombok'</span>, name: <span class="string">'lombok'</span>, version: <span class="string">'1.16.14'</span></span><br></pre></td></tr></table></figure>
<h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h3><p>你可以在方法或类型的构造方法的参数前添加<code>@NonNull</code>，这样就可以不用写参数为Null的检查代码了。<br>也可以用在字段定义上</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonNullExample</span> <span class="keyword">extends</span> <span class="title">Something</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">NonNullExample</span><span class="params">(@NonNull Person person)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="string">"Hello"</span>);</span><br><span class="line">    <span class="keyword">this</span>.name = person.getName();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Cleanup"><a href="#Cleanup" class="headerlink" title="@Cleanup"></a>@Cleanup</h3><p>自动调用<code>close()</code>方法来释放资源。不过从Java 7开始有了<a href="http://www.ituring.com.cn/article/9288" target="_blank" rel="noopener"><code>TWR</code></a>，感觉这个注解用处不大了。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Cleanup;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CleanupExample</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="meta">@Cleanup</span> InputStream in = <span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]);</span><br><span class="line">    <span class="meta">@Cleanup</span> OutputStream out = <span class="keyword">new</span> FileOutputStream(args[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">10000</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> r = in.read(b);</span><br><span class="line">      <span class="keyword">if</span> (r == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">      out.write(b, <span class="number">0</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Getter-Setter"><a href="#Getter-Setter" class="headerlink" title="@Getter / @Setter"></a>@Getter / @Setter</h3><p>从此以后再也不用写<code>getXX()</code>和<code>setXX()</code>方法了。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetterSetterExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Getter</span> <span class="meta">@Setter</span> <span class="keyword">private</span> <span class="keyword">int</span> age = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Setter</span>(AccessLevel.PROTECTED) <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"%s (age: %d)"</span>, name, age);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ToString"><a href="#ToString" class="headerlink" title="@ToString"></a>@ToString</h3><p>为一个类型自动重写<code>toString()</code>方法。默认会返回类型名称，以及每一个字段的值，使用逗号分隔。</p>
<ul>
<li>设置<code>includeFieldName=true</code>让输出内容更清晰明确，同时也增加了输出内容的长度。</li>
<li>默认情况下，所有的非静态字段都会输出。可以设置<code>exclude</code>属性来排除不想输出的字段，还可以设置<code>of</code>属性的值来明确的指定想要输出的字段。</li>
<li>通过设置<code>callSuper=true</code>，可以包含父类型的<code>toString()</code>输出结果，这在继承了其它类型的时候很有用。</li>
</ul>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span>(exclude=<span class="string">"id"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToStringExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STATIC_VAR = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> Shape shape = <span class="keyword">new</span> Square(<span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">private</span> String[] tags;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.getName();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ToString</span>(callSuper=<span class="keyword">true</span>, includeFieldNames=<span class="keyword">true</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> width, height;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Square</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.width = width;</span><br><span class="line">      <span class="keyword">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="EqualsAndHashCode"><a href="#EqualsAndHashCode" class="headerlink" title="@EqualsAndHashCode"></a>@EqualsAndHashCode</h3><p>自动为类型重写<code>equals()</code>和<code>hashCode()</code>方法。默认情况下会使用到所有的非静态字段和非<code>transient</code>字段（添加了<code>transient</code>修饰符的字段不会被持久化，常用于密码等不能或不需要持久化的字段）。可以设置<code>exclude</code>属性来排除不想输出的字段，还可以设置<code>of</code>属性的值来明确的指定想要输出的字段。<br>在继承自<code>java.lang.Object</code>的类型上设置<code>callSuper=true</code>时编译会出错。在继承自其它类型时，如果没有设置<code>callSuper=true</code>在编译时会有警告。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(exclude=&#123;<span class="string">"id"</span>, <span class="string">"shape"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EqualsAndHashCodeExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> transientVar = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> score;</span><br><span class="line">  <span class="keyword">private</span> Shape shape = <span class="keyword">new</span> Square(<span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">private</span> String[] tags;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@EqualsAndHashCode</span>(callSuper=<span class="keyword">true</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> width, height;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Square</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.width = width;</span><br><span class="line">      <span class="keyword">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="NoArgsConstructor-RequiredArgsConstructor和-AllArgsConstructor"><a href="#NoArgsConstructor-RequiredArgsConstructor和-AllArgsConstructor" class="headerlink" title="@NoArgsConstructor, @RequiredArgsConstructor和@AllArgsConstructor"></a>@NoArgsConstructor, @RequiredArgsConstructor和@AllArgsConstructor</h3><p><code>@NoArgsConstructor</code>会生成一个无参数的构造方法。 对于定义了<code>final</code>字段的类型，需要使用<code>@NoArgsConstructor(force = true)</code>，这样所有的<code>final</code>字段都会使用<code>0/false/null</code>初始化，否则会在编译时出错。此时需要注意的是，<strong>添加了<code>@NonNull</code>注解的字段，不会自动生成检查或赋值的代码</strong>。<br><code>@RequiredArgsConstructor</code>生成一个包含所有需要初始化的字段为参数的构造方法。所有的<code>final</code>字段都有一个参数，所有使用了<code>@NonNull</code>注解又没有初始化过的字段也有一个参数。参数的顺序与字段在类型中定义的先后顺序相同。<br><code>@AllArgsConstructor</code>生成一个包含了类型中定义的全部字段做为参数的构造方法。<br>以上三个注解都有一个<code>staticName</code>属性，使用这个属性会生成私有的构造方法，然后添加一个指定名称的静态工厂方法，推荐的名称是<code>of</code>。这样就可以使用<code>MapEntry.of(&quot;foo&quot;, 5)</code>这样的方式来创建一个新的<code>MapEntry</code>实例了。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span>(staticName = <span class="string">"of"</span>)</span><br><span class="line"><span class="meta">@AllArgsConstructor</span>(access = AccessLevel.PROTECTED)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstructorExample</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> x, y;</span><br><span class="line">  <span class="meta">@NonNull</span> <span class="keyword">private</span> T description;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NoArgsConstructor</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NoArgsExample</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> String field;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h3><p>集成了<code>@ToString</code>、<code>@EqualsAndHashCode</code>、所有字段的<code>@Getter</code>、所有非<code>final</code>字段的<code>@Setter</code>和<code>@RequiredArgsConstructor</code>。<br>大部分情况下，只使用<code>@Data</code>注解就够用了。</p>
<h3 id="Log"><a href="#Log" class="headerlink" title="@Log"></a>@Log</h3><p>可以在任何类型上使用此注解生成一个名称为<code>log</code>的字段。此字段的类型有以下可选项：</p>
<ul>
<li><code>@CommonsLog</code> - org.apache.commons.logging.Log</li>
<li><code>@JBossLog</code> - org.jboss.logging.Logger</li>
<li><code>@Log</code> - java.util.logging.Logger</li>
<li><code>@Log4j</code> - org.apache.log4j.Logger</li>
<li><code>@Log4j2</code> - org.apache.logging.log4j.Logger</li>
<li><code>@Slf4j</code> - org.slf4j.Logger</li>
<li><code>@XSlf4j</code> - org.slf4j.ext.XLogger</li>
</ul>
<p>可以设置<code>topic</code>属性来修改logger的名称，例如：<code>@Log(topic=&quot;reporting&quot;)</code></p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.java.Log;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    log.error(<span class="string">"Something's wrong here"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogExampleOther</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    log.error(<span class="string">"Something else is wrong here"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CommonsLog</span>(topic=<span class="string">"CounterLog"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogExampleCategory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    log.error(<span class="string">"Calling the 'CounterLog' with a message"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h3><p>和<code>@Data</code>类似，不同的是默认所有的字段都会加上<code>private</code>和<code>final</code>修饰符，会生成<code>getXX()</code>方法，不会生成<code>setXX()</code>方法，类型本身也会加上<code>final</code>修饰符，会生成<code>toString()</code>、<code>equals()</code>和<code>hashCode()</code>方法，还会生成一个包含所有字段（不包含字段定义时已经初始化了的）作为参数的构造方法。<br>实际上<code>@Value</code>是<code>final</code>、<code>@ToString</code>、 <code>@EqualsAndHashCode</code>、<code>@AllArgsConstructor</code>、<code>@FieldDefaults(makeFinal = true, level = AccessLevel.PRIVATE)</code>和<code>@Getter</code>的简写形式。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.NonFinal;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Value;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Wither;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueExample</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  <span class="meta">@Wither</span>(AccessLevel.PACKAGE) <span class="meta">@NonFinal</span> <span class="keyword">int</span> age;</span><br><span class="line">  <span class="keyword">double</span> score;</span><br><span class="line">  <span class="keyword">protected</span> String[] tags;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ToString</span>(includeFieldNames=<span class="keyword">true</span>)</span><br><span class="line">  <span class="meta">@Value</span>(staticConstructor=<span class="string">"of"</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    T value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h3><p>快速实现<a href="https://quanke.gitbooks.io/design-pattern-java/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F-Builder%20Pattern.html" target="_blank" rel="noopener">建造者模式</a>。<br>其中<code>@Singular</code>注解只能使用在集合类型字段或参数上。此时不会生成对应的<code>setXX()</code>方法，而会生成两个<code>addXX()</code>方法，一个用来添加单个元素，另一个用来添加另一个集合中的所有元素。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Singular;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuilderExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">  <span class="meta">@Singular</span> <span class="keyword">private</span> Set&lt;String&gt; occupations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="SneakyThrows"><a href="#SneakyThrows" class="headerlink" title="@SneakyThrows"></a>@SneakyThrows</h3><p>使用<code>@SneakyThrows</code>注解，就可以不用再写<code>try ... catch...</code>了。这是一个有争议的功能，使用时一定要当心。通常在以下两种情况时使用：</p>
<ul>
<li>过于严格的接口。<br>比如<code>Runnable</code>，不论在<code>run()</code>方法中产生了什么异常，代码有没有对此异常进行过处理，异常最后都会被传递到线程的未捕获异常句柄（unhandled exception handler）。</li>
<li>不可能会出错的时候。<br>比如<code>new String(someByteArray, &quot;UTF-8&quot;);</code>,这个语句声明了会抛出<code>UnsupportedEncodingException</code>，可是在JVM中UTF-8始终是可用的，也就是说不可能会抛出<code>UnsupportedEncodingException</code>。</li>
</ul>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SneakyThrowsExample</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@SneakyThrows</span>(UnsupportedEncodingException.class)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">utf8ToString</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(bytes, <span class="string">"UTF-8"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Throwable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>不使用<code>@SneakyThrows</code>的等效代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SneakyThrowsExample</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">utf8ToString</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> String(bytes, <span class="string">"UTF-8"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> Lombok.sneakyThrow(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Throwable();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">      <span class="keyword">throw</span> Lombok.sneakyThrow(t);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Synchronized"><a href="#Synchronized" class="headerlink" title="@Synchronized"></a>@Synchronized</h3><p>相比<code>synchronized</code>修饰符更安全。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Synchronized;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object readLock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Synchronized</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"world"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Synchronized</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">answerToLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Synchronized</span>(<span class="string">"readLock"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"bar"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>不使用<code>@Synchronized</code>的等效代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object $LOCK = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object $lock = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object readLock = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>($LOCK) &#123;</span><br><span class="line">      System.out.println(<span class="string">"world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">answerToLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>($lock) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(readLock) &#123;</span><br><span class="line">      System.out.println(<span class="string">"bar"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Getter-lazy-true"><a href="#Getter-lazy-true" class="headerlink" title="@Getter(lazy=true)"></a>@Getter(lazy=true)</h3><p>此注解会生成一个<code>getXX()</code>方法，此方法只会在第一次被调用时计算且只计算这一次，之后会把结果缓存下来。这在代码消耗CPU或内存较大的时候很有用。编写的代码不需要考虑线程安全问题，lombok会帮你解决这个问题。</p>
<p>示例代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetterLazyExample</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Getter</span>(lazy=<span class="keyword">true</span>) <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span>[] cached = expensive();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span>[] expensive() &#123;</span><br><span class="line">    <span class="keyword">double</span>[] result = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">1000000</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">      result[i] = Math.asin(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>不使用<code>@Getter(lazy=true)</code>的等效代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetterLazyExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> java.util.concurrent.AtomicReference&lt;java.lang.Object&gt; cached = <span class="keyword">new</span> java.util.concurrent.AtomicReference&lt;java.lang.Object&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">double</span>[] getCached() &#123;</span><br><span class="line">    java.lang.Object value = <span class="keyword">this</span>.cached.get();</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span>(<span class="keyword">this</span>.cached) &#123;</span><br><span class="line">        value = <span class="keyword">this</span>.cached.get();</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">double</span>[] actualValue = expensive();</span><br><span class="line">          value = actualValue == <span class="keyword">null</span> ? <span class="keyword">this</span>.cached : actualValue;</span><br><span class="line">          <span class="keyword">this</span>.cached.set(value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">double</span>[])(value == <span class="keyword">this</span>.cached ? <span class="keyword">null</span> : value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span>[] expensive() &#123;</span><br><span class="line">    <span class="keyword">double</span>[] result = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">1000000</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">      result[i] = Math.asin(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://lrwinx.github.io/2017/03/04/%E7%BB%86%E6%80%9D%E6%9E%81%E6%81%90-%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BC%9A%E5%86%99java%E5%90%97/" target="_blank" rel="noopener">细思极恐-你真的会写java吗</a> （建议每个java工程师都认真读一遍）<br><a href="http://deepinmind.iteye.com/blog/2041907" target="_blank" rel="noopener">Lombok: Java开发的利器</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2017/03/07/RestTemplate获取复杂JSON类型返回值/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/07/RestTemplate获取复杂JSON类型返回值/" itemprop="url">RestTemplate获取复杂JSON类型返回值</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T18:20:52+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Spring-RestTemplate获取复杂JSON类型返回值"><a href="#Spring-RestTemplate获取复杂JSON类型返回值" class="headerlink" title="Spring RestTemplate获取复杂JSON类型返回值"></a>Spring RestTemplate获取复杂JSON类型返回值</h3><p>简单的类型可以直接转换，如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User[] users = <span class="keyword">this</span>.restTemplate.getForObject(<span class="string">"/users/"</span>, User[].class);</span><br></pre></td></tr></table></figure></p>
<p>如果是较复杂的类型，可以先获取返回的json字符串，再转换成需要的类型。<br>示例代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String json = restTemplate.getForObject(buildUrl, String.class);</span><br><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//convert JSON string to Map</span></span><br><span class="line">   map = mapper.readValue(json, <span class="keyword">new</span> TypeReference&lt;HashMap&lt;String,String&gt;&gt;()&#123;&#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">     logger.info(<span class="string">"Exception converting &#123;&#125; to map"</span>, json, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> map;</span><br></pre></td></tr></table></figure></p>
<p>参考链接：<br><a href="http://stackoverflow.com/questions/23674046/get-list-of-json-objects-with-spring-resttemplate" target="_blank" rel="noopener">http://stackoverflow.com/questions/23674046/get-list-of-json-objects-with-spring-resttemplate</a><br><a href="http://stackoverflow.com/questions/24208828/resttemplate-getforobject-map-responsetype" target="_blank" rel="noopener">http://stackoverflow.com/questions/24208828/resttemplate-getforobject-map-responsetype</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bfsong.github.io/2017/03/07/Hamcrest入门教程（链接）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="baofeng.song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baofeng.song">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/07/Hamcrest入门教程（链接）/" itemprop="url">Hamcrest入门教程（链接汇总）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T18:18:50+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Hamcrest入门教程"><a href="#Hamcrest入门教程" class="headerlink" title="Hamcrest入门教程"></a>Hamcrest入门教程</h4><p><a href="https://code.google.com/archive/p/hamcrest/wikis/Tutorial.wiki" target="_blank" rel="noopener">英文</a><br><a href="http://thinkdevos.net/blog/20161129/java-unit-test-hamcrest/" target="_blank" rel="noopener">中文</a><br><a href="http://hamcrest.org/JavaHamcrest/javadoc/1.3/" target="_blank" rel="noopener">API</a></p>
<h4 id="其它链接"><a href="#其它链接" class="headerlink" title="其它链接"></a>其它链接</h4><p><a href="https://zh.wikipedia.org/wiki/Hamcrest" target="_blank" rel="noopener">维基百科 中文</a><br><a href="http://dreamhead.blogbus.com/tag/hamcrest/" target="_blank" rel="noopener">Hamcrest简介</a><br><a href="http://simonwoo.github.io/blog/2016/01/10/Hamcrest%E4%BD%BF%E7%94%A8/" target="_blank" rel="noopener">Hamcrest使用</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="baofeng.song" />
            
              <p class="site-author-name" itemprop="name">baofeng.song</p>
              <p class="site-description motion-element" itemprop="description">学习,记录,思考</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/bfsong" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">baofeng.song</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
